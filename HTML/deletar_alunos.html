<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deletar Aluno - GymSystem</title>
  <link rel="stylesheet" href="/CSS/deletar_aluno.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
  <header>
    <h1>GymSystem</h1>
    <p>Organize sua Academia com Facilidade!</p>
  </header>
  
  <form id="formDeletar">
    <input type="text" id="cpf" placeholder="Digite o CPF (apenas números)" required>
    <button type="submit">Deletar Cadastro</button>
  </form>

  <div id="mensagem"></div>
  
  <div>
    <h3>Últimos deletados:</h3>
    <ul id="listaDeletados"></ul>
  </div>

  <script>
    const form = document.getElementById('formDeletar');
    const mensagem = document.getElementById('mensagem');
    const listaDeletados = document.getElementById('listaDeletados');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const cpf = document.getElementById('cpf').value.trim();

      if (!cpf || !/^\d{11}$/.test(cpf)) {
        mostrarMensagem("CPF inválido. Digite exatamente 11 números.", "erro");
        return;
      }

      try {
        // 1. Verifica se o aluno existe e deleta
        const response = await fetch(`http://localhost:8000/alunos/${cpf}`, {
          method: 'DELETE'
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || "Erro ao deletar aluno");
        }

        // 2. Adiciona à lista de deletados
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>Nome:</strong> ${data.aluno.nome}<br>
          <strong>CPF:</strong> ${data.aluno.cpf}<br>
          <strong>Plano:</strong> ${data.aluno.plano}
        `;
        listaDeletados.prepend(li); // Adiciona no início da lista

        mostrarMensagem(data.message, "sucesso");
        
      } catch (erro) {
        mostrarMensagem(erro.message, "erro");
        console.error(erro);
      }

      form.reset();
    });

    function mostrarMensagem(texto, tipo) {
      mensagem.textContent = texto;
      mensagem.className = tipo;
      setTimeout(() => mensagem.textContent = '', 5000);
    }
  </script>
</body>
</html>